DEBUGGING

Let's test some objects for Moon separation
We'll use date of 2025/12/7, time of 22:00:00 civil

Let's check the following values reported by my astro_planner
            REPORTED SEPARATION
OBJECT      ASTRO_PLANNER       STELLARIUM      KSTARS
NGC598      72.46               86              86
NGC2403     39.43               43              43
NGC7331     102.14              113             113
NGC1023     57.12               70              70

| Object | astro_planner | Stellarium | KStars |
|:-----|:-------|:------|---------|
| NGC0598| 72            | 86         | 86     |
| NGC2403| 39            | 43         | 42     |
| NGC7331| 102           | 113        | 113    |
| NGC1023| 57            | 70         | 70     |


Planner.py
Line 234 - observer = earth + wgs84.latlon(latitude_degrees=lat, longitude_degrees=lon, elevation_m=elev)
Line 239 - astrometric_moon = observer.at(t_snapshot).observe(moon)
Line 326 - astrometric = observer.at(t_snapshot).observe(star)
Line 400 - ast = observer.at(ts_sample).observe(star)

Output from moon_test.py
NGC0598   RA= 23.4625  Dec= 30.6603  Sep=83.454753 deg  (rounded -> 83°)
NGC2403   RA=114.1242  Dec= 65.6945  Sep=42.341655 deg  (rounded -> 42°)
NGC7331   RA=339.0146  Dec= 34.4208  Sep=111.221099 deg  (rounded -> 111°)
NGC1023   RA= 40.1125  Dec= 39.6181  Sep=67.743484 deg  (rounded -> 67°)

NGC0598 from KStars
JNow:	01h 35m 03s	 30° 45' 20"
J2000:	01h 33m 34s	 30° 37' 08"
AzAlt:	 253° 34' 04"	 71° 40' 09"

NGC0598 from OpenNGC.csv
01:33:50.89	+30:39:36.8

2025/12/8
CODE COMPARISON WITH moon_test.py
Note that the moon_test.py script values agree very closely with Stellarium and KStars, but planner.py
values do not. ChatGPT is getting really confused, so I'm going to do a close comparison between
programs to see if I can spot the problem.


2025/12/12

times, events = almanac.find_discrete(t0, t1, f)

    # events: True = sunrise transition (Sun up after), False = sunset transition (Sun down after)
    next_sunrise_t = None
    next_sunset_t  = None

    for tt, ev in zip(times, events):
        if tt.tt <= t_snapshot.tt:
            continue
        if ev and next_sunrise_t is None:
            next_sunrise_t = tt
        if (not ev) and next_sunset_t is None:
            next_sunset_t = tt
        if next_sunrise_t is not None and next_sunset_t is not None:
            break

    # Format Skyfield Time to local datetime string
    def _format_tt_local(tt):
        if tt is None:
            return "N/A"
        # convert Skyfield Time to timezone-aware UTC datetime, then to LOCAL_TZ
        from datetime import timezone
        dt_utc = tt.utc_datetime().replace(tzinfo=timezone.utc)
        dt_local = dt_utc.astimezone(LOCAL_TZ)
        return dt_local.strftime("%Y-%m-%d %H:%M")

    sunrise_str = _format_tt_local(next_sunrise_t)
    sunset_str  = _format_tt_local(next_sunset_t)